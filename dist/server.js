var express = require('express');
var path = require('path');
var port = process.env.PORT || 3000;
var app = express();
var bodyParser = require('body-parser');
var mongoose = require('mongoose');
var jwt = require('express-jwt');
var cors = require('cors');
var Bear = require('./models/bear');
var Apartment = require('./models/apartment');
var BusinessUnit = require('./models/businessunit');
app.use('/app', express.static(path.resolve(__dirname, 'app')));
app.use('/libs', express.static(path.resolve(__dirname, 'libs')));
app.use(cors());
var dbstring = process.env.MONGOLAB_URI ||
    process.env.MONGOHQ_URL ||
    'mongodb://heroku_cb2hb6wm:5plmn61cgsp0l5roqa2qh83mgk@ds011439.mlab.com:11439/heroku_cb2hb6wm';
var server = app.listen(port, function () {
    var host = server.address().address;
    var port = server.address().port;
    console.log('This express app is listening on port:' + port);
});
var authCheck = jwt({
    secret: new Buffer('460DPY7Pi4xnRUiirPuEfBdxS4wzQGcx8rlA-Qw76fURkmiwtrhv_IXffzsI84HM', 'base64'),
    audience: '1mvHGykVHvxzpwstp2wTmrzLrpzouVTm'
});
mongoose.connect(dbstring, function (err, res) {
    if (err) {
        console.log('ERROR connecting to: ' + dbstring + '. ' + err);
    }
    else {
        console.log('Successfully connected to: ' + dbstring);
    }
    ;
});
app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());
var router = express.Router();
router.get('/app/*', function (req, res) {
    res.sendFile(path.resolve(__dirname, 'index.html'));
});
router.get('/api', authCheck, function (req, res) {
    res.json({ message: 'hooray! welcome to our api!' });
});
router.route('/api/bears') //while posting pass name=value in parameter body. No space.
    .post(function (req, res) {
    var bear = new Bear();
    bear.name = req.body.name;
    bear.save(function (err) {
        if (err)
            res.send(err);
        res.json({ message: 'Bear created!' });
    });
})
    .get(function (req, res) {
    Bear.find(function (err, bears) {
        if (err)
            res.send(err);
        res.json(bears);
    });
});
router.route('/api/bears/:bear_id')
    .get(function (req, res) {
    Bear.findById(req.params.bear_id, function (err, bear) {
        if (err)
            res.send(err);
        res.json(bear);
    });
})
    .put(function (req, res) {
    Bear.findById(req.params.bear_id, function (err, bear) {
        if (err)
            res.send(err);
        bear.name = req.body.name;
        bear.save(function (err) {
            if (err)
                res.send(err);
            res.json({ message: 'Bear updated!' });
        });
    });
})
    .delete(function (req, res) {
    Bear.remove({
        _id: req.params.bear_id
    }, function (err, bear) {
        if (err)
            res.send(err);
        res.json({ message: 'Successfully deleted' });
    });
});
router.route('/api/apartments')
    .post(function (req, res) {
    var apartment = new Apartment();
    apartment.name = req.body.name;
    apartment.save(function (err) {
        if (err)
            res.send(err);
        res.json({ message: 'Apartment created!' });
    });
})
    .get(function (req, res) {
    Apartment.find(function (err, apartments) {
        if (err)
            res.send(err);
        res.json(apartments);
    });
});
router.route('/api/apartments/:apartment_id')
    .get(function (req, res) {
    Apartment.findById(req.params.apartment_id, function (err, apartment) {
        if (err)
            res.send(err);
        res.json(apartment);
    });
})
    .put(function (req, res) {
    Apartment.findById(req.params.apartment_id, function (err, apartment) {
        if (err)
            res.send(err);
        apartment.name = req.body.name;
        apartment.save(function (err) {
            if (err)
                res.send(err);
            res.json({ message: 'apartment updated!' });
        });
    });
})
    .delete(function (req, res) {
    Apartment.remove({
        _id: req.params.apartment_id
    }, function (err, apartment) {
        if (err)
            res.send(err);
        res.json({ message: 'Successfully deleted' });
    });
});
router.route('/api/businessunits')
    .post(function (req, res) {
    var businessUnit = new BusinessUnit();
    businessUnit.name = req.body.name;
    businessUnit.save(function (err) {
        if (err)
            res.send(err);
        res.json({ message: 'businessUnit created!' });
    });
})
    .get(function (req, res) {
    BusinessUnit.find(function (err, businessunits) {
        if (err)
            res.send(err);
        res.json(businessunits);
    });
});
router.route('/api/businessUnits/:businessUnit_id')
    .get(function (req, res) {
    BusinessUnit.findById(req.params.businessUnit_id, function (err, businessUnit) {
        if (err)
            res.send(err);
        res.json(businessUnit);
    });
})
    .put(function (req, res) {
    BusinessUnit.findById(req.params.businessUnit_id, function (err, businessUnit) {
        if (err)
            res.send(err);
        businessUnit.name = req.body.name;
        businessUnit.save(function (err) {
            if (err)
                res.send(err);
            res.json({ message: 'businessUnit updated!' });
        });
    });
})
    .delete(function (req, res) {
    BusinessUnit.remove({
        _id: req.params.businessUnit_id
    }, function (err, businessUnit) {
        if (err)
            res.send(err);
        res.json({ message: 'Successfully deleted' });
    });
});
app.use('/', router);

//# sourceMappingURL=data:application/json;base64,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cmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuaW1wb3J0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XHJcbnZhciBwb3J0OiBudW1iZXIgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDMwMDA7XHJcbnZhciBhcHAgPSBleHByZXNzKCk7XHJcbnZhciBib2R5UGFyc2VyID0gcmVxdWlyZSgnYm9keS1wYXJzZXInKTtcclxudmFyIG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcclxudmFyIGp3dCA9IHJlcXVpcmUoJ2V4cHJlc3Mtand0Jyk7XHJcbnZhciBjb3JzID0gcmVxdWlyZSgnY29ycycpO1xyXG5cclxudmFyIEJlYXIgPSByZXF1aXJlKCcuL21vZGVscy9iZWFyJyk7IFxyXG52YXIgQXBhcnRtZW50ID0gcmVxdWlyZSgnLi9tb2RlbHMvYXBhcnRtZW50Jyk7XHJcbnZhciBCdXNpbmVzc1VuaXQgPSByZXF1aXJlKCcuL21vZGVscy9idXNpbmVzc3VuaXQnKTsgXHJcblxyXG5hcHAudXNlKCcvYXBwJywgZXhwcmVzcy5zdGF0aWMocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJ2FwcCcpKSk7XHJcbmFwcC51c2UoJy9saWJzJywgZXhwcmVzcy5zdGF0aWMocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJ2xpYnMnKSkpO1xyXG5hcHAudXNlKGNvcnMoKSk7XHJcblxyXG5cclxuXHJcbnZhciBkYnN0cmluZyA9XHJcbiAgICBwcm9jZXNzLmVudi5NT05HT0xBQl9VUkkgfHxcclxuICAgIHByb2Nlc3MuZW52Lk1PTkdPSFFfVVJMIHx8XHJcbiAgICAnbW9uZ29kYjovL2hlcm9rdV9jYjJoYjZ3bTo1cGxtbjYxY2dzcDBsNXJvcWEycWg4M21na0BkczAxMTQzOS5tbGFiLmNvbToxMTQzOS9oZXJva3VfY2IyaGI2d20nO1xyXG5cclxudmFyIHNlcnZlciA9IGFwcC5saXN0ZW4ocG9ydCwgZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgaG9zdCA9IHNlcnZlci5hZGRyZXNzKCkuYWRkcmVzcztcclxuICAgIHZhciBwb3J0ID0gc2VydmVyLmFkZHJlc3MoKS5wb3J0O1xyXG4gICAgY29uc29sZS5sb2coJ1RoaXMgZXhwcmVzcyBhcHAgaXMgbGlzdGVuaW5nIG9uIHBvcnQ6JyArIHBvcnQpO1xyXG59KTtcclxuXHJcbnZhciBhdXRoQ2hlY2sgPSBqd3Qoe1xyXG4gIHNlY3JldDogbmV3IEJ1ZmZlcignNDYwRFBZN1BpNHhuUlVpaXJQdUVmQmR4UzR3elFHY3g4cmxBLVF3NzZmVVJrbWl3dHJodl9JWGZmenNJODRITScsICdiYXNlNjQnKSxcclxuICBhdWRpZW5jZTogJzFtdkhHeWtWSHZ4enB3c3RwMndUbXJ6THJwem91VlRtJ1xyXG59KTtcclxuXHJcbm1vbmdvb3NlLmNvbm5lY3QoZGJzdHJpbmcsIGZ1bmN0aW9uIChlcnIsIHJlcykge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nICgnRVJST1IgY29ubmVjdGluZyB0bzogJyArIGRic3RyaW5nICsgJy4gJyArIGVycik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUubG9nICgnU3VjY2Vzc2Z1bGx5IGNvbm5lY3RlZCB0bzogJyArIGRic3RyaW5nKTtcclxuICAgICAgfTtcclxufSk7XHJcblxyXG5hcHAudXNlKGJvZHlQYXJzZXIudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKTtcclxuYXBwLnVzZShib2R5UGFyc2VyLmpzb24oKSk7XHJcblxyXG52YXIgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuXHJcbnJvdXRlci5nZXQoJy9hcHAvKicsIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgIHJlcy5zZW5kRmlsZShwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnaW5kZXguaHRtbCcpKTtcclxufSk7XHJcblxyXG5yb3V0ZXIuZ2V0KCcvYXBpJyxhdXRoQ2hlY2ssIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ2hvb3JheSEgd2VsY29tZSB0byBvdXIgYXBpIScgfSk7XHJcbn0pO1xyXG5cclxucm91dGVyLnJvdXRlKCcvYXBpL2JlYXJzJykgICAgICAgICAgLy93aGlsZSBwb3N0aW5nIHBhc3MgbmFtZT12YWx1ZSBpbiBwYXJhbWV0ZXIgYm9keS4gTm8gc3BhY2UuXHJcbiAgICAucG9zdChmdW5jdGlvbihyZXEsIHJlcykgeyAgICAgICAgXHJcbiAgICAgICAgdmFyIGJlYXIgPSBuZXcgQmVhcigpO1xyXG4gICAgICAgIGJlYXIubmFtZSA9IHJlcS5ib2R5Lm5hbWU7XHJcblxyXG4gICAgICAgIGJlYXIuc2F2ZShmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ0JlYXIgY3JlYXRlZCEnIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gIH0pXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgQmVhci5maW5kKGZ1bmN0aW9uKGVyciwgYmVhcnMpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcblxyXG4gICAgICAgICAgICByZXMuanNvbihiZWFycyk7XHJcbiAgICAgICAgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgcm91dGVyLnJvdXRlKCcvYXBpL2JlYXJzLzpiZWFyX2lkJykgICAgXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgQmVhci5maW5kQnlJZChyZXEucGFyYW1zLmJlYXJfaWQsIGZ1bmN0aW9uKGVyciwgYmVhcikge1xyXG4gICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgcmVzLmpzb24oYmVhcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KVxyXG5cclxuICAgIC5wdXQoZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgICAgICBCZWFyLmZpbmRCeUlkKHJlcS5wYXJhbXMuYmVhcl9pZCwgZnVuY3Rpb24oZXJyLCBiZWFyKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICBiZWFyLm5hbWUgPSByZXEuYm9keS5uYW1lOyAgXHJcbiAgICAgICAgICAgIGJlYXIuc2F2ZShmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ0JlYXIgdXBkYXRlZCEnIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pXHJcblxyXG4gICAgLmRlbGV0ZShmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIEJlYXIucmVtb3ZlKHtcclxuICAgICAgICAgICAgX2lkOiByZXEucGFyYW1zLmJlYXJfaWRcclxuICAgICAgICB9LCBmdW5jdGlvbihlcnIsIGJlYXIpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcblxyXG4gICAgICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdTdWNjZXNzZnVsbHkgZGVsZXRlZCcgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgcm91dGVyLnJvdXRlKCcvYXBpL2FwYXJ0bWVudHMnKSAgICAgICAgICBcclxuICAgIC5wb3N0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7ICAgICAgICBcclxuICAgICAgICB2YXIgYXBhcnRtZW50ID0gbmV3IEFwYXJ0bWVudCgpO1xyXG4gICAgICAgIGFwYXJ0bWVudC5uYW1lID0gcmVxLmJvZHkubmFtZTtcclxuXHJcbiAgICAgICAgYXBhcnRtZW50LnNhdmUoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdBcGFydG1lbnQgY3JlYXRlZCEnIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gIH0pXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgQXBhcnRtZW50LmZpbmQoZnVuY3Rpb24oZXJyLCBhcGFydG1lbnRzKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG5cclxuICAgICAgICAgICAgcmVzLmpzb24oYXBhcnRtZW50cyk7XHJcbiAgICAgICAgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgcm91dGVyLnJvdXRlKCcvYXBpL2FwYXJ0bWVudHMvOmFwYXJ0bWVudF9pZCcpICAgIFxyXG4gICAgLmdldChmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIEFwYXJ0bWVudC5maW5kQnlJZChyZXEucGFyYW1zLmFwYXJ0bWVudF9pZCwgZnVuY3Rpb24oZXJyLCBhcGFydG1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKGFwYXJ0bWVudCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KVxyXG5cclxuICAgIC5wdXQoZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgICAgICBBcGFydG1lbnQuZmluZEJ5SWQocmVxLnBhcmFtcy5hcGFydG1lbnRfaWQsIGZ1bmN0aW9uKGVyciwgYXBhcnRtZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICBhcGFydG1lbnQubmFtZSA9IHJlcS5ib2R5Lm5hbWU7ICBcclxuICAgICAgICAgICAgYXBhcnRtZW50LnNhdmUoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdhcGFydG1lbnQgdXBkYXRlZCEnIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pXHJcblxyXG4gICAgLmRlbGV0ZShmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIEFwYXJ0bWVudC5yZW1vdmUoe1xyXG4gICAgICAgICAgICBfaWQ6IHJlcS5wYXJhbXMuYXBhcnRtZW50X2lkXHJcbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyLCBhcGFydG1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcblxyXG4gICAgICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdTdWNjZXNzZnVsbHkgZGVsZXRlZCcgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByb3V0ZXIucm91dGUoJy9hcGkvYnVzaW5lc3N1bml0cycpICAgICAgICAgIFxyXG4gICAgLnBvc3QoZnVuY3Rpb24ocmVxLCByZXMpIHsgICAgICAgIFxyXG4gICAgICAgIHZhciBidXNpbmVzc1VuaXQgPSBuZXcgQnVzaW5lc3NVbml0KCk7XHJcbiAgICAgICAgYnVzaW5lc3NVbml0Lm5hbWUgPSByZXEuYm9keS5uYW1lO1xyXG5cclxuICAgICAgICBidXNpbmVzc1VuaXQuc2F2ZShmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ2J1c2luZXNzVW5pdCBjcmVhdGVkIScgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgfSlcclxuICAgIC5nZXQoZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgICAgICBCdXNpbmVzc1VuaXQuZmluZChmdW5jdGlvbihlcnIsIGJ1c2luZXNzdW5pdHMpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcblxyXG4gICAgICAgICAgICByZXMuanNvbihidXNpbmVzc3VuaXRzKTtcclxuICAgICAgICB9KTtcclxuICB9KTtcclxuICBcclxuICByb3V0ZXIucm91dGUoJy9hcGkvYnVzaW5lc3NVbml0cy86YnVzaW5lc3NVbml0X2lkJykgICAgXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgQnVzaW5lc3NVbml0LmZpbmRCeUlkKHJlcS5wYXJhbXMuYnVzaW5lc3NVbml0X2lkLCBmdW5jdGlvbihlcnIsIGJ1c2luZXNzVW5pdCkge1xyXG4gICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgcmVzLmpzb24oYnVzaW5lc3NVbml0KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pXHJcblxyXG4gICAgLnB1dChmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIEJ1c2luZXNzVW5pdC5maW5kQnlJZChyZXEucGFyYW1zLmJ1c2luZXNzVW5pdF9pZCwgZnVuY3Rpb24oZXJyLCBidXNpbmVzc1VuaXQpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIGJ1c2luZXNzVW5pdC5uYW1lID0gcmVxLmJvZHkubmFtZTsgIFxyXG4gICAgICAgICAgICBidXNpbmVzc1VuaXQuc2F2ZShmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ2J1c2luZXNzVW5pdCB1cGRhdGVkIScgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSlcclxuXHJcbiAgICAuZGVsZXRlKGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgQnVzaW5lc3NVbml0LnJlbW92ZSh7XHJcbiAgICAgICAgICAgIF9pZDogcmVxLnBhcmFtcy5idXNpbmVzc1VuaXRfaWRcclxuICAgICAgICB9LCBmdW5jdGlvbihlcnIsIGJ1c2luZXNzVW5pdCkge1xyXG4gICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuXHJcbiAgICAgICAgICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSBkZWxldGVkJyB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuXHJcbmFwcC51c2UoJy8nLCByb3V0ZXIpO1xyXG5cclxuXHJcblxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
