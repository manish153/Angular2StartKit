"use strict";
const express = require('express');
const path = require('path');
var port = process.env.PORT || 3000;
var app = express();
var bodyParser = require('body-parser');
var mongoose = require('mongoose');
var jwt = require('express-jwt');
var cors = require('cors');
var router = express.Router();
var multer = require('multer');
var multers3 = require('multer-s3');
var serveIndex = require('serve-index');
var aws = require('aws-sdk');
var Apartment = require('./models/apartment');
var InternalUser = require('./models/internaluser');
var BusinessUnit = require('./models/businessunit');
var Files = require('./models/file');
var Task = require('./models/task');
var FileMongo = require('./models/file');
var s3 = new aws.S3({});
var upload = multer({
    storage: multers3({
        s3: s3,
        bucket: 'angular2files',
        key: function (req, file, cb, res) {
            cb(null, file.originalname); //use Date.now() for unique file key           
            //            filelocation = file.location;
            //            res.send(file);
        }
    })
});
app.use('/app', express.static(path.resolve(__dirname, 'app')));
app.use('/libs', express.static(path.resolve(__dirname, 'libs')));
app.use('/uploads', express.static(path.resolve(__dirname, 'uploads')));
app.use('/filesdirectory', serveIndex(__dirname + '/uploads'));
app.use(cors());
app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());
app.use(function (req, res, next) {
    res.header("Access-Control-Allow-Origin", "*");
    res.header("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept");
    next();
});
//duplicate files are not handled, best would be to send multer filename to aws
app.post('/s3upload', upload.array('uploads[]', 12), function (req, res, next) {
    var filemongo = new FileMongo();
    filemongo.originalname = req.files[0].originalname;
    filemongo._idapt = req.body._idapt;
    filemongo.createddate = Date.now();
    //req.file
    //console.log(req.file.originalname);         
    filemongo.save(function (err) {
    });
    (res.send(req.files));
});
var dbstring = process.env.MONGOLAB_URI ||
    process.env.MONGOHQ_URL ||
    'mongodb://heroku_d4n6hnhl:q4rfc1uikd51d5sups9mipivnl@ds057254.mlab.com:57254/heroku_d4n6hnhl';
var server = app.listen(port, function () {
    var host = server.address().address;
    var port = server.address().port;
    console.log('This express app is listening on port:' + port);
});
var authCheck = jwt({
    secret: new Buffer('460DPY7Pi4xnRUiirPuEfBdxS4wzQGcx8rlA-Qw76fURkmiwtrhv_IXffzsI84HM', 'base64'),
    audience: '1mvHGykVHvxzpwstp2wTmrzLrpzouVTm'
});
mongoose.connect(dbstring, function (err, res) {
    if (err) {
        console.log('ERROR connecting to: ' + dbstring + '. ' + err);
    }
    else {
        console.log('Successfully connected to: ' + dbstring);
    }
    ;
});
router.get('/app/*', function (req, res) {
    res.sendFile(path.resolve(__dirname, 'index.html'));
});
router.get('/api', authCheck, function (req, res) {
    res.json({ message: 'hooray! welcome to our api!' });
});
// router.route('/api/getusers')    
//   .get(function(req, res) {        
//       Apartment.find({userEmail: {$exists: true, $ne: null}},'userEmail', function(err, apartments) {
//           if (err)
//               res.send(err);
//           res.json(apartments);
//       });
//   })
router.route('/api/apartments/updateprofile/:_id')
    .put(function (req, res) {
    Apartment.findById(req.params._id, function (err, apartment) {
        if (err)
            res.send(err);
        apartment.userFirstName = req.body.userFirstName;
        apartment.save(function (err) {
            if (err)
                res.send(err);
            res.json({ message: 'user profile updated!' });
        });
    });
});
router.route('/api/apartments/getprofile/:userEmail')
    .get(function (req, res) {
    Apartment.find({ userEmail: req.params.userEmail }, function (err, apartment) {
        if (err)
            res.send(err);
        res.json(apartment);
    });
});
//Business Unit Service endpoints 
router.route('/api/businessunits')
    .get(function (req, res) {
    BusinessUnit.find({ BusinessUnitName: { $exists: true } }, function (err, businessunits) {
        if (err)
            res.send(err);
        res.json(businessunits);
    });
});
router.route('/api/businessunits/butype')
    .get(function (req, res) {
    BusinessUnit.find({ unitID: { $exists: true }, UnitType: { $exists: true } }, 'unitID UnitType', { sort: { unitID: 1 } }, function (err, businessunits) {
        if (err)
            res.send(err);
        res.json(businessunits);
    });
});
router.route('/api/apartments/getstats')
    .get(function (req, res) {
    Apartment.find('aptType', function (err, apartments) {
        if (err)
            res.send(err);
        res.json(apartments);
    });
});
router.route('/api/apartments/getdetails/:aptType/:aptStatus')
    .get(function (req, res) {
    Apartment.find({ $and: [{ aptType: req.params.aptType }, { aptStatus: req.params.aptStatus }] }, function (err, apartments) {
        if (err)
            res.send(err);
        res.json(apartments);
    });
});
router.route('/api/apartments/files/:_idapt')
    .get(function (req, res) {
    Files.find({ _idapt: req.params._idapt }).sort({ createddate: -1 }).limit(3).exec(function (err, files) {
        if (err)
            res.send(err);
        res.json(files);
    });
});
router.route('/api/editapt/:_id')
    .put(function (req, res) {
    Apartment.findById(req.params._id, function (err, apartments) {
        if (err)
            res.send(err);
        apartments.aptDesc = req.body.aptDesc;
        apartments.aptAddress = req.body.aptAddress;
        apartments.aptStatus = req.body.aptStatus;
        apartments.leaseStartDate = req.body.leaseStartDate;
        apartments.leaseEndDate = req.body.leaseEndDate;
        apartments.residentFirstName = req.body.residentFirstName;
        apartments.residentLastName = req.body.residentLastName;
        apartments.residentEmail = req.body.residentEmail;
        apartments.residentDOB = req.body.residentDOB;
        apartments.secondaryResidentFirstName = req.body.secondaryResidentFirstName;
        apartments.secondaryResidentLastName = req.body.secondaryResidentLastName;
        apartments.secondaryResidentEmail = req.body.secondaryResidentEmail;
        apartments.secondaryResidentDOB = req.body.secondaryResidentDOB;
        apartments.rentAmount = req.body.rentAmount;
        apartments.save(function (err) {
            if (err)
                res.send(err);
            res.json({ message: 'Apt updated!' });
        });
    });
});
//not working for some reason, chaining incorrect
router.route('/api/apartments/search/:aptID')
    .get(function (req, res) {
    Apartment.find({ $text: { $search: req.params.aptID } }, function (err, apartments) {
        console.log("inside search " + req.params.aptID);
        if (err)
            res.send(err);
        res.json(apartments);
    });
});
/*Task Endpoints*/
router.route('/api/newtask')
    .post(function (req, res) {
    var task = new Task();
    task.taskname = req.body.taskname;
    task.taskdesc = req.body.taskdesc;
    task.assignedto = req.body.assignedto;
    task.taskstatus = 'OPEN';
    task.tasktype = 'task';
    task.save(function (err) {
        if (err)
            res.send(err);
        res.json({ message: 'Task created!' });
    });
})
    .get(function (req, res) {
    Task.find(function (err, tasks) {
        if (err)
            res.send(err);
        res.json(tasks);
    });
});
router.route('/api/mytask/:userEmail')
    .get(function (req, res) {
    Task.find({ $and: [{ assignedto: req.params.userEmail.toLowerCase() }, { taskstatus: 'OPEN' }] }, function (err, task) {
        if (err)
            res.send(err);
        res.json(task);
    });
});
router.route('/api/newtask/:_id')
    .get(function (req, res) {
    Task.findById(req.params.task_id, function (err, task) {
        if (err)
            res.send(err);
        res.json(task);
    });
})
    .put(function (req, res) {
    Task.findById(req.params._id, function (err, task) {
        if (err)
            res.send(err);
        task.taskname = req.body.taskname;
        task.taskdesc = req.body.taskdesc;
        task.save(function (err) {
            if (err)
                res.send(err);
            res.json({ message: 'task updated!' });
        });
    });
})
    .delete(function (req, res) {
    Task.remove({
        _id: req.params.task_id
    }, function (err, task) {
        if (err)
            res.send(err);
        res.json({ message: 'Successfully deleted' });
    });
});
router.route('/api/mark/:_id')
    .put(function (req, res) {
    Task.findById(req.params._id, function (err, task) {
        if (err)
            res.send(err);
        task.taskstatus = 'CLOSED';
        task.save(function (err) {
            if (err)
                res.send(err);
            res.json({ message: 'task updated!' });
        });
    });
});
/*Request Endpoints*/
router.route('/api/newrequest')
    .post(function (req, res) {
    var task = new Task();
    task.taskname = req.body.taskname;
    task.taskdesc = req.body.taskdesc;
    task.tasktype = 'request';
    task.save(function (err) {
        if (err)
            res.send(err);
        res.json({ message: 'Request created!' });
    });
});
router.route('/api/myrequest/:userEmail')
    .get(function (req, res) {
    Task.find({ $and: [{ assignedto: req.params.userEmail.toLowerCase() }, { tasktype: 'request' }] }, function (err, task) {
        if (err)
            res.send(err);
        res.json(task);
    });
});
router.route('/api/adminrequest')
    .get(function (req, res) {
    Task.find({ tasktype: 'request' }, function (err, task) {
        if (err)
            res.send(err);
        res.json(task);
    });
});
router.route('/api/convertrequest/:_id')
    .put(function (req, res) {
    Task.findById(req.params._id, function (err, task) {
        if (err)
            res.send(err);
        task.tasktype = 'task';
        task.assignedto = req.body.assignedto;
        task.taskstatus = 'OPEN';
        task.save(function (err) {
            if (err)
                res.send(err);
            res.json({ message: 'task updated!' });
        });
    });
});
router.route('/api/getinternalusers')
    .get(function (req, res) {
    InternalUser.find({ $and: [{ Email: { $exists: true, $ne: null } }, { Status: 'Active' }] }, 'Email', function (err, internalusers) {
        if (err)
            res.send(err);
        res.json(internalusers);
    });
});
app.use('/', router);

//# sourceMappingURL=data:application/json;base64,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QyxDQUFDLEVBQUMsVUFBVSxFQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxFQUFDLEVBQUMsRUFBQyxVQUFVLEVBQUMsTUFBTSxFQUFDLENBQUMsRUFBQyxFQUFFLFVBQVMsR0FBRyxFQUFFLElBQUk7UUFDdEcsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ0osR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQixHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25CLENBQUMsQ0FBQyxDQUFDO0FBQ1QsQ0FBQyxDQUFDLENBQUE7QUFFRixNQUFNLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDO0tBQzlCLEdBQUcsQ0FBQyxVQUFTLEdBQUcsRUFBRSxHQUFHO0lBQ2xCLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsVUFBUyxHQUFHLEVBQUUsSUFBSTtRQUNoRCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDSixHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkIsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUM7S0FFRCxHQUFHLENBQUMsVUFBUyxHQUFHLEVBQUUsR0FBRztJQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLFVBQVMsR0FBRyxFQUFFLElBQUk7UUFDNUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ0osR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQixJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFTLEdBQUc7WUFDbEIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO2dCQUNKLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbEIsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsQ0FBQyxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUM7S0FFRCxNQUFNLENBQUMsVUFBUyxHQUFHLEVBQUUsR0FBRztJQUNyQixJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ1IsR0FBRyxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTztLQUMxQixFQUFFLFVBQVMsR0FBRyxFQUFFLElBQUk7UUFDakIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ0osR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVsQixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLENBQUMsQ0FBQztJQUNsRCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDO0FBRUgsTUFBTSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQztLQUM3QixHQUFHLENBQUMsVUFBUyxHQUFHLEVBQUUsR0FBRztJQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLFVBQVMsR0FBRyxFQUFFLElBQUk7UUFDNUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ0osR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQixJQUFJLENBQUMsVUFBVSxHQUFHLFFBQVEsQ0FBQztRQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVMsR0FBRztZQUNsQixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUM7Z0JBQ0osR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNsQixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxDQUFDLENBQUM7UUFDM0MsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFBO0FBRUoscUJBQXFCO0FBRXJCLE1BQU0sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUM7S0FDNUIsSUFBSSxDQUFDLFVBQVMsR0FBRyxFQUFFLEdBQUc7SUFDbkIsSUFBSSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUN0QixJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ2xDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDbEMsSUFBSSxDQUFDLFFBQVEsR0FBRyxTQUFTLENBQUM7SUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFTLEdBQUc7UUFDbEIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ0osR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLENBQUMsQ0FBQztJQUM5QyxDQUFDLENBQUMsQ0FBQztBQUNULENBQUMsQ0FBQyxDQUFBO0FBR0YsTUFBTSxDQUFDLEtBQUssQ0FBQywyQkFBMkIsQ0FBQztLQUN0QyxHQUFHLENBQUMsVUFBUyxHQUFHLEVBQUUsR0FBRztJQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFDLENBQUMsRUFBQyxVQUFVLEVBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLEVBQUMsRUFBQyxFQUFDLFFBQVEsRUFBQyxTQUFTLEVBQUMsQ0FBQyxFQUFDLEVBQUUsVUFBUyxHQUFHLEVBQUUsSUFBSTtRQUN2RyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDSixHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkIsQ0FBQyxDQUFDLENBQUM7QUFDVCxDQUFDLENBQUMsQ0FBQTtBQUVGLE1BQU0sQ0FBQyxLQUFLLENBQUMsbUJBQW1CLENBQUM7S0FDOUIsR0FBRyxDQUFDLFVBQVMsR0FBRyxFQUFFLEdBQUc7SUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFDLFFBQVEsRUFBQyxTQUFTLEVBQUMsRUFBRSxVQUFTLEdBQUcsRUFBRSxJQUFJO1FBQzlDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUNKLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEIsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuQixDQUFDLENBQUMsQ0FBQztBQUNULENBQUMsQ0FBQyxDQUFBO0FBRUYsTUFBTSxDQUFDLEtBQUssQ0FBQywwQkFBMEIsQ0FBQztLQUNyQyxHQUFHLENBQUMsVUFBUyxHQUFHLEVBQUUsR0FBRztJQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLFVBQVMsR0FBRyxFQUFFLElBQUk7UUFDNUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ0osR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQixJQUFJLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQztRQUN2QixJQUFJLENBQUMsVUFBVSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ3RDLElBQUksQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBUyxHQUFHO1lBQ2xCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQztnQkFDSixHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2xCLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUMsQ0FBQztRQUMzQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUE7QUFFSixNQUFNLENBQUMsS0FBSyxDQUFDLHVCQUF1QixDQUFDO0tBQ2xDLEdBQUcsQ0FBQyxVQUFTLEdBQUcsRUFBRSxHQUFHO0lBQ2xCLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBQyxJQUFJLEVBQUMsQ0FBQyxFQUFDLEtBQUssRUFBRSxFQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBQyxFQUFDLEVBQUMsRUFBQyxNQUFNLEVBQUMsUUFBUSxFQUFDLENBQUMsRUFBQyxFQUFDLE9BQU8sRUFBRSxVQUFTLEdBQUcsRUFBRSxhQUFhO1FBQ2pILEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUNSLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDZCxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQzVCLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUE7QUFFTixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQyIsImZpbGUiOiJzZXJ2ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuaW1wb3J0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XHJcbnZhciBwb3J0OiBudW1iZXIgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDMwMDA7XHJcbnZhciBhcHAgPSBleHByZXNzKCk7XHJcbnZhciBib2R5UGFyc2VyID0gcmVxdWlyZSgnYm9keS1wYXJzZXInKTtcclxudmFyIG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcclxudmFyIGp3dCA9IHJlcXVpcmUoJ2V4cHJlc3Mtand0Jyk7XHJcbnZhciBjb3JzID0gcmVxdWlyZSgnY29ycycpO1xyXG52YXIgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxudmFyIG11bHRlciA9IHJlcXVpcmUoJ211bHRlcicpO1xyXG52YXIgbXVsdGVyczMgPSByZXF1aXJlKCdtdWx0ZXItczMnKTtcclxudmFyIHNlcnZlSW5kZXggPSByZXF1aXJlKCdzZXJ2ZS1pbmRleCcpO1xyXG52YXIgYXdzID0gcmVxdWlyZSgnYXdzLXNkaycpXHJcblxyXG52YXIgQXBhcnRtZW50ID0gcmVxdWlyZSgnLi9tb2RlbHMvYXBhcnRtZW50Jyk7XHJcbnZhciBJbnRlcm5hbFVzZXIgPSByZXF1aXJlKCcuL21vZGVscy9pbnRlcm5hbHVzZXInKTtcclxudmFyIEJ1c2luZXNzVW5pdCA9IHJlcXVpcmUoJy4vbW9kZWxzL2J1c2luZXNzdW5pdCcpOyBcclxudmFyIEZpbGVzID0gcmVxdWlyZSgnLi9tb2RlbHMvZmlsZScpO1xyXG52YXIgVGFzayA9IHJlcXVpcmUoJy4vbW9kZWxzL3Rhc2snKTtcclxudmFyIEZpbGVNb25nbyA9IHJlcXVpcmUoJy4vbW9kZWxzL2ZpbGUnKTtcclxudmFyIHMzID0gbmV3IGF3cy5TMyh7IC8qIC4uLiAqLyB9KTtcclxuXHJcbnZhciB1cGxvYWQgPSBtdWx0ZXIoe1xyXG4gICAgc3RvcmFnZTogbXVsdGVyczMoe1xyXG4gICAgICAgIHMzOnMzLCAgICAgICBcclxuICAgICAgICBidWNrZXQ6ICdhbmd1bGFyMmZpbGVzJyxcclxuICAgICAgICBrZXk6IGZ1bmN0aW9uIChyZXEsZmlsZSwgY2IscmVzKSB7XHJcbiAgICAgICAgICAgICAgY2IobnVsbCwgZmlsZS5vcmlnaW5hbG5hbWUpOyAvL3VzZSBEYXRlLm5vdygpIGZvciB1bmlxdWUgZmlsZSBrZXkgICAgICAgICAgIFxyXG4gIC8vICAgICAgICAgICAgZmlsZWxvY2F0aW9uID0gZmlsZS5sb2NhdGlvbjtcclxuICAvLyAgICAgICAgICAgIHJlcy5zZW5kKGZpbGUpO1xyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbn0pO1xyXG5cclxuYXBwLnVzZSgnL2FwcCcsIGV4cHJlc3Muc3RhdGljKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdhcHAnKSkpO1xyXG5hcHAudXNlKCcvbGlicycsIGV4cHJlc3Muc3RhdGljKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdsaWJzJykpKTtcclxuYXBwLnVzZSgnL3VwbG9hZHMnLCBleHByZXNzLnN0YXRpYyhwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAndXBsb2FkcycpKSk7XHJcbmFwcC51c2UoJy9maWxlc2RpcmVjdG9yeScsIHNlcnZlSW5kZXgoX19kaXJuYW1lICsgJy91cGxvYWRzJykpO1xyXG5hcHAudXNlKGNvcnMoKSk7XHJcbmFwcC51c2UoYm9keVBhcnNlci51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUgfSkpO1xyXG5hcHAudXNlKGJvZHlQYXJzZXIuanNvbigpKTtcclxuXHJcblxyXG5hcHAudXNlKGZ1bmN0aW9uKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICByZXMuaGVhZGVyKFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCIsIFwiKlwiKTtcclxuICAgIHJlcy5oZWFkZXIoXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzXCIsIFwiT3JpZ2luLCBYLVJlcXVlc3RlZC1XaXRoLCBDb250ZW50LVR5cGUsIEFjY2VwdFwiKTtcclxuICAgIG5leHQoKTtcclxufSk7XHJcblxyXG4vL2R1cGxpY2F0ZSBmaWxlcyBhcmUgbm90IGhhbmRsZWQsIGJlc3Qgd291bGQgYmUgdG8gc2VuZCBtdWx0ZXIgZmlsZW5hbWUgdG8gYXdzXHJcbmFwcC5wb3N0KCcvczN1cGxvYWQnLCB1cGxvYWQuYXJyYXkoJ3VwbG9hZHNbXScsMTIpLCBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcclxuICAgICAgICAgdmFyIGZpbGVtb25nbyA9IG5ldyBGaWxlTW9uZ28oKTtcclxuICAgICAgICAgZmlsZW1vbmdvLm9yaWdpbmFsbmFtZSA9IHJlcS5maWxlc1swXS5vcmlnaW5hbG5hbWU7XHJcbiAgICAgICAgIGZpbGVtb25nby5faWRhcHQgPSByZXEuYm9keS5faWRhcHQ7XHJcbiAgICAgICAgIGZpbGVtb25nby5jcmVhdGVkZGF0ZSA9IERhdGUubm93KCk7XHJcbiAgICAgICAgIC8vcmVxLmZpbGVcclxuICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXEuZmlsZS5vcmlnaW5hbG5hbWUpOyAgICAgICAgIFxyXG4gICAgICAgICBmaWxlbW9uZ28uc2F2ZShmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICB9KTtcclxuICAgIChyZXMuc2VuZChyZXEuZmlsZXMpKTsgXHJcbn0pO1xyXG5cclxudmFyIGRic3RyaW5nID1cclxuICAgIHByb2Nlc3MuZW52Lk1PTkdPTEFCX1VSSSB8fFxyXG4gICAgcHJvY2Vzcy5lbnYuTU9OR09IUV9VUkwgfHxcclxuICAgICdtb25nb2RiOi8vaGVyb2t1X2Q0bjZobmhsOnE0cmZjMXVpa2Q1MWQ1c3VwczltaXBpdm5sQGRzMDU3MjU0Lm1sYWIuY29tOjU3MjU0L2hlcm9rdV9kNG42aG5obCc7XHJcblxyXG52YXIgc2VydmVyID0gYXBwLmxpc3Rlbihwb3J0LCBmdW5jdGlvbigpIHtcclxuICAgIHZhciBob3N0ID0gc2VydmVyLmFkZHJlc3MoKS5hZGRyZXNzO1xyXG4gICAgdmFyIHBvcnQgPSBzZXJ2ZXIuYWRkcmVzcygpLnBvcnQ7XHJcbiAgICBjb25zb2xlLmxvZygnVGhpcyBleHByZXNzIGFwcCBpcyBsaXN0ZW5pbmcgb24gcG9ydDonICsgcG9ydCk7XHJcbn0pO1xyXG5cclxudmFyIGF1dGhDaGVjayA9IGp3dCh7XHJcbiAgc2VjcmV0OiBuZXcgQnVmZmVyKCc0NjBEUFk3UGk0eG5SVWlpclB1RWZCZHhTNHd6UUdjeDhybEEtUXc3NmZVUmttaXd0cmh2X0lYZmZ6c0k4NEhNJywgJ2Jhc2U2NCcpLFxyXG4gIGF1ZGllbmNlOiAnMW12SEd5a1ZIdnh6cHdzdHAyd1RtcnpMcnB6b3VWVG0nXHJcbn0pO1xyXG5cclxubW9uZ29vc2UuY29ubmVjdChkYnN0cmluZywgZnVuY3Rpb24gKGVyciwgcmVzKSB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgY29uc29sZS5sb2cgKCdFUlJPUiBjb25uZWN0aW5nIHRvOiAnICsgZGJzdHJpbmcgKyAnLiAnICsgZXJyKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS5sb2cgKCdTdWNjZXNzZnVsbHkgY29ubmVjdGVkIHRvOiAnICsgZGJzdHJpbmcpO1xyXG4gICAgICB9O1xyXG59KTtcclxuXHJcbnJvdXRlci5nZXQoJy9hcHAvKicsIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgIHJlcy5zZW5kRmlsZShwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnaW5kZXguaHRtbCcpKTtcclxufSk7XHJcblxyXG5yb3V0ZXIuZ2V0KCcvYXBpJyxhdXRoQ2hlY2ssIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ2hvb3JheSEgd2VsY29tZSB0byBvdXIgYXBpIScgfSk7XHJcbn0pO1xyXG5cclxuICAvLyByb3V0ZXIucm91dGUoJy9hcGkvZ2V0dXNlcnMnKSAgICBcclxuICAvLyAgIC5nZXQoZnVuY3Rpb24ocmVxLCByZXMpIHsgICAgICAgIFxyXG4gIC8vICAgICAgIEFwYXJ0bWVudC5maW5kKHt1c2VyRW1haWw6IHskZXhpc3RzOiB0cnVlLCAkbmU6IG51bGx9fSwndXNlckVtYWlsJywgZnVuY3Rpb24oZXJyLCBhcGFydG1lbnRzKSB7XHJcbiAgLy8gICAgICAgICAgIGlmIChlcnIpXHJcbiAgLy8gICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gIC8vICAgICAgICAgICByZXMuanNvbihhcGFydG1lbnRzKTtcclxuICAgICAgICAgICAgXHJcbiAgLy8gICAgICAgfSk7XHJcbiAgLy8gICB9KVxyXG5cclxuICAgIHJvdXRlci5yb3V0ZSgnL2FwaS9hcGFydG1lbnRzL3VwZGF0ZXByb2ZpbGUvOl9pZCcpICAgIFxyXG4gICAgLnB1dChmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIEFwYXJ0bWVudC5maW5kQnlJZChyZXEucGFyYW1zLl9pZCwgZnVuY3Rpb24oZXJyLCBhcGFydG1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgYXBhcnRtZW50LnVzZXJGaXJzdE5hbWUgPSByZXEuYm9keS51c2VyRmlyc3ROYW1lOyAgXHJcbiAgICAgICAgICAgIGFwYXJ0bWVudC5zYXZlKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICAgICAgcmVzLmpzb24oeyBtZXNzYWdlOiAndXNlciBwcm9maWxlIHVwZGF0ZWQhJyB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KVxyXG4gIFxyXG4gICAgcm91dGVyLnJvdXRlKCcvYXBpL2FwYXJ0bWVudHMvZ2V0cHJvZmlsZS86dXNlckVtYWlsJykgICAgXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgQXBhcnRtZW50LmZpbmQoe3VzZXJFbWFpbDpyZXEucGFyYW1zLnVzZXJFbWFpbH0sZnVuY3Rpb24oZXJyLCBhcGFydG1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKGFwYXJ0bWVudCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KVxyXG4gICAgXHJcbiAgIC8vQnVzaW5lc3MgVW5pdCBTZXJ2aWNlIGVuZHBvaW50cyBcclxuICAgIHJvdXRlci5yb3V0ZSgnL2FwaS9idXNpbmVzc3VuaXRzJykgICAgICAgICAgICAgXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgQnVzaW5lc3NVbml0LmZpbmQoe0J1c2luZXNzVW5pdE5hbWU6IHskZXhpc3RzOiB0cnVlfX0sZnVuY3Rpb24oZXJyLCBidXNpbmVzc3VuaXRzKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG5cclxuICAgICAgICAgICAgcmVzLmpzb24oYnVzaW5lc3N1bml0cyk7XHJcbiAgICAgICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gICAgcm91dGVyLnJvdXRlKCcvYXBpL2J1c2luZXNzdW5pdHMvYnV0eXBlJykgICAgICAgICAgICAgXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgQnVzaW5lc3NVbml0LmZpbmQoe3VuaXRJRDogeyRleGlzdHM6IHRydWV9LCBVbml0VHlwZTogeyRleGlzdHM6IHRydWV9fSwndW5pdElEIFVuaXRUeXBlJyx7c29ydDp7dW5pdElEOiAxfX0sZnVuY3Rpb24oZXJyLCBidXNpbmVzc3VuaXRzKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG5cclxuICAgICAgICAgICAgcmVzLmpzb24oYnVzaW5lc3N1bml0cyk7XHJcbiAgICAgICAgIH0pO1xyXG4gICB9KTsgICBcclxuXHJcbiAgICByb3V0ZXIucm91dGUoJy9hcGkvYXBhcnRtZW50cy9nZXRzdGF0cycpICAgICAgICAgICAgIFxyXG4gICAgLmdldChmdW5jdGlvbihyZXEsIHJlcykgeyAgICAgICAgXHJcbiAgICAgICAgICBBcGFydG1lbnQuZmluZCgnYXB0VHlwZScsZnVuY3Rpb24oZXJyLCBhcGFydG1lbnRzKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICByZXMuanNvbihhcGFydG1lbnRzKTtcclxuICAgICAgICAgfSk7XHJcbiAgIH0pOyAgICAgICBcclxuIFxyXG4gICByb3V0ZXIucm91dGUoJy9hcGkvYXBhcnRtZW50cy9nZXRkZXRhaWxzLzphcHRUeXBlLzphcHRTdGF0dXMnKSAgICAgICAgICAgICBcclxuICAgIC5nZXQoZnVuY3Rpb24ocmVxLCByZXMpIHsgICAgICAgIFxyXG4gICAgICAgICAgQXBhcnRtZW50LmZpbmQoeyRhbmQ6W3thcHRUeXBlOnJlcS5wYXJhbXMuYXB0VHlwZX0se2FwdFN0YXR1czpyZXEucGFyYW1zLmFwdFN0YXR1c31dfSwgZnVuY3Rpb24oZXJyLCBhcGFydG1lbnRzKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICByZXMuanNvbihhcGFydG1lbnRzKTtcclxuICAgICAgICAgfSk7XHJcbiAgIH0pOyAgICAgICBcclxuXHJcblxyXG4gICAgcm91dGVyLnJvdXRlKCcvYXBpL2FwYXJ0bWVudHMvZmlsZXMvOl9pZGFwdCcpICAgICAgICAgICAgIFxyXG4gICAgLmdldChmdW5jdGlvbihyZXEsIHJlcykgeyAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIEZpbGVzLmZpbmQoe19pZGFwdDpyZXEucGFyYW1zLl9pZGFwdH0pLnNvcnQoe2NyZWF0ZWRkYXRlOiAtMX0pLmxpbWl0KDMpLmV4ZWMoZnVuY3Rpb24oZXJyLCBmaWxlcykge1xyXG4gICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgcmVzLmpzb24oZmlsZXMpO1xyXG4gICAgICAgIH0pO1xyXG4gICB9KTsgIFxyXG5cclxuICAgcm91dGVyLnJvdXRlKCcvYXBpL2VkaXRhcHQvOl9pZCcpICBcclxuICAgIC5wdXQoZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgICAgICBBcGFydG1lbnQuZmluZEJ5SWQocmVxLnBhcmFtcy5faWQsIGZ1bmN0aW9uKGVyciwgYXBhcnRtZW50cykge1xyXG4gICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgYXBhcnRtZW50cy5hcHREZXNjID0gcmVxLmJvZHkuYXB0RGVzYztcclxuICAgICAgICAgICAgYXBhcnRtZW50cy5hcHRBZGRyZXNzID0gcmVxLmJvZHkuYXB0QWRkcmVzcztcclxuICAgICAgICAgICAgYXBhcnRtZW50cy5hcHRTdGF0dXMgPSByZXEuYm9keS5hcHRTdGF0dXM7XHJcbiAgICAgICAgICAgIGFwYXJ0bWVudHMubGVhc2VTdGFydERhdGUgPSByZXEuYm9keS5sZWFzZVN0YXJ0RGF0ZTtcclxuICAgICAgICAgICAgYXBhcnRtZW50cy5sZWFzZUVuZERhdGUgPSByZXEuYm9keS5sZWFzZUVuZERhdGU7XHJcbiAgICAgICAgICAgIGFwYXJ0bWVudHMucmVzaWRlbnRGaXJzdE5hbWUgPSByZXEuYm9keS5yZXNpZGVudEZpcnN0TmFtZTtcclxuICAgICAgICAgICAgYXBhcnRtZW50cy5yZXNpZGVudExhc3ROYW1lID0gcmVxLmJvZHkucmVzaWRlbnRMYXN0TmFtZTsgICBcclxuICAgICAgICAgICAgYXBhcnRtZW50cy5yZXNpZGVudEVtYWlsID0gcmVxLmJvZHkucmVzaWRlbnRFbWFpbDtcclxuICAgICAgICAgICAgYXBhcnRtZW50cy5yZXNpZGVudERPQiA9IHJlcS5ib2R5LnJlc2lkZW50RE9CO1xyXG4gICAgICAgICAgICBhcGFydG1lbnRzLnNlY29uZGFyeVJlc2lkZW50Rmlyc3ROYW1lID0gcmVxLmJvZHkuc2Vjb25kYXJ5UmVzaWRlbnRGaXJzdE5hbWU7XHJcbiAgICAgICAgICAgIGFwYXJ0bWVudHMuc2Vjb25kYXJ5UmVzaWRlbnRMYXN0TmFtZSA9IHJlcS5ib2R5LnNlY29uZGFyeVJlc2lkZW50TGFzdE5hbWU7XHJcbiAgICAgICAgICAgIGFwYXJ0bWVudHMuc2Vjb25kYXJ5UmVzaWRlbnRFbWFpbCA9IHJlcS5ib2R5LnNlY29uZGFyeVJlc2lkZW50RW1haWw7XHJcbiAgICAgICAgICAgIGFwYXJ0bWVudHMuc2Vjb25kYXJ5UmVzaWRlbnRET0IgPSByZXEuYm9keS5zZWNvbmRhcnlSZXNpZGVudERPQjtcclxuICAgICAgICAgICAgYXBhcnRtZW50cy5yZW50QW1vdW50ID0gcmVxLmJvZHkucmVudEFtb3VudDsgICAgICAgICBcclxuICAgICAgICAgICAgYXBhcnRtZW50cy5zYXZlKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICAgICAgcmVzLmpzb24oeyBtZXNzYWdlOiAnQXB0IHVwZGF0ZWQhJyB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KSAgXHJcblxyXG4gICAvL25vdCB3b3JraW5nIGZvciBzb21lIHJlYXNvbiwgY2hhaW5pbmcgaW5jb3JyZWN0XHJcbiAgICByb3V0ZXIucm91dGUoJy9hcGkvYXBhcnRtZW50cy9zZWFyY2gvOmFwdElEJylcclxuICAgIC5nZXQoZnVuY3Rpb24ocmVxLHJlcyl7XHJcbiAgICAgICAgQXBhcnRtZW50LmZpbmQoeyAkdGV4dCA6IHsgJHNlYXJjaCA6IHJlcS5wYXJhbXMuYXB0SUQgfX0sZnVuY3Rpb24oZXJyLGFwYXJ0bWVudHMpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImluc2lkZSBzZWFyY2ggXCIgKyByZXEucGFyYW1zLmFwdElEKTtcclxuICAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgcmVzLmpzb24oYXBhcnRtZW50cyk7XHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcblxyXG5cclxuXHJcbiAgLypUYXNrIEVuZHBvaW50cyovXHJcblxyXG4gIHJvdXRlci5yb3V0ZSgnL2FwaS9uZXd0YXNrJylcclxuICAgIC5wb3N0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7ICAgICAgICBcclxuICAgICAgICB2YXIgdGFzayA9IG5ldyBUYXNrKCk7XHJcbiAgICAgICAgdGFzay50YXNrbmFtZSA9IHJlcS5ib2R5LnRhc2tuYW1lO1xyXG4gICAgICAgIHRhc2sudGFza2Rlc2MgPSByZXEuYm9keS50YXNrZGVzYztcclxuICAgICAgICB0YXNrLmFzc2lnbmVkdG8gPSByZXEuYm9keS5hc3NpZ25lZHRvO1xyXG4gICAgICAgIHRhc2sudGFza3N0YXR1cyA9ICdPUEVOJztcclxuICAgICAgICB0YXNrLnRhc2t0eXBlID0gJ3Rhc2snO1xyXG4gICAgICAgIHRhc2suc2F2ZShmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ1Rhc2sgY3JlYXRlZCEnIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gIH0pXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgVGFzay5maW5kKGZ1bmN0aW9uKGVyciwgdGFza3MpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHRhc2tzKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgfSk7XHJcbiAgIFxyXG5cclxuICAgIFxyXG4gIHJvdXRlci5yb3V0ZSgnL2FwaS9teXRhc2svOnVzZXJFbWFpbCcpICAgIFxyXG4gICAgLmdldChmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIFRhc2suZmluZCh7JGFuZDpbe2Fzc2lnbmVkdG86cmVxLnBhcmFtcy51c2VyRW1haWwudG9Mb3dlckNhc2UoKX0se3Rhc2tzdGF0dXM6J09QRU4nfV19LCBmdW5jdGlvbihlcnIsIHRhc2spIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHRhc2spO1xyXG4gICAgICAgIH0pO1xyXG4gIH0pICBcclxuICBcclxuICByb3V0ZXIucm91dGUoJy9hcGkvbmV3dGFzay86X2lkJykgICAgXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgVGFzay5maW5kQnlJZChyZXEucGFyYW1zLnRhc2tfaWQsIGZ1bmN0aW9uKGVyciwgdGFzaykge1xyXG4gICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgcmVzLmpzb24odGFzayk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KVxyXG5cclxuICAgIC5wdXQoZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgICAgICBUYXNrLmZpbmRCeUlkKHJlcS5wYXJhbXMuX2lkLCBmdW5jdGlvbihlcnIsIHRhc2spIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHRhc2sudGFza25hbWUgPSByZXEuYm9keS50YXNrbmFtZTsgIFxyXG4gICAgICAgICAgICB0YXNrLnRhc2tkZXNjID0gcmVxLmJvZHkudGFza2Rlc2M7XHJcbiAgICAgICAgICAgIHRhc2suc2F2ZShmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ3Rhc2sgdXBkYXRlZCEnIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pXHJcblxyXG4gICAgLmRlbGV0ZShmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIFRhc2sucmVtb3ZlKHtcclxuICAgICAgICAgICAgX2lkOiByZXEucGFyYW1zLnRhc2tfaWRcclxuICAgICAgICB9LCBmdW5jdGlvbihlcnIsIHRhc2spIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcblxyXG4gICAgICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdTdWNjZXNzZnVsbHkgZGVsZXRlZCcgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByb3V0ZXIucm91dGUoJy9hcGkvbWFyay86X2lkJykgIFxyXG4gICAgLnB1dChmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIFRhc2suZmluZEJ5SWQocmVxLnBhcmFtcy5faWQsIGZ1bmN0aW9uKGVyciwgdGFzaykge1xyXG4gICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgdGFzay50YXNrc3RhdHVzID0gJ0NMT1NFRCc7ICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgdGFzay5zYXZlKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICAgICAgcmVzLmpzb24oeyBtZXNzYWdlOiAndGFzayB1cGRhdGVkIScgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSkgIFxyXG5cclxuICAvKlJlcXVlc3QgRW5kcG9pbnRzKi9cclxuXHJcbiAgcm91dGVyLnJvdXRlKCcvYXBpL25ld3JlcXVlc3QnKVxyXG4gICAgLnBvc3QoZnVuY3Rpb24ocmVxLCByZXMpIHsgICAgICAgIFxyXG4gICAgICAgIHZhciB0YXNrID0gbmV3IFRhc2soKTtcclxuICAgICAgICB0YXNrLnRhc2tuYW1lID0gcmVxLmJvZHkudGFza25hbWU7XHJcbiAgICAgICAgdGFzay50YXNrZGVzYyA9IHJlcS5ib2R5LnRhc2tkZXNjOyAgICAgICAgXHJcbiAgICAgICAgdGFzay50YXNrdHlwZSA9ICdyZXF1ZXN0JztcclxuICAgICAgICB0YXNrLnNhdmUoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdSZXF1ZXN0IGNyZWF0ZWQhJyB9KTtcclxuICAgICAgICB9KTtcclxuICB9KVxyXG5cclxuXHJcbiAgcm91dGVyLnJvdXRlKCcvYXBpL215cmVxdWVzdC86dXNlckVtYWlsJykgICAgXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgVGFzay5maW5kKHskYW5kOlt7YXNzaWduZWR0bzpyZXEucGFyYW1zLnVzZXJFbWFpbC50b0xvd2VyQ2FzZSgpfSx7dGFza3R5cGU6J3JlcXVlc3QnfV19LCBmdW5jdGlvbihlcnIsIHRhc2spIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHRhc2spO1xyXG4gICAgICAgIH0pO1xyXG4gIH0pICBcclxuICBcclxuICByb3V0ZXIucm91dGUoJy9hcGkvYWRtaW5yZXF1ZXN0JykgICAgXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgVGFzay5maW5kKHt0YXNrdHlwZToncmVxdWVzdCd9LCBmdW5jdGlvbihlcnIsIHRhc2spIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHRhc2spO1xyXG4gICAgICAgIH0pO1xyXG4gIH0pXHJcblxyXG4gIHJvdXRlci5yb3V0ZSgnL2FwaS9jb252ZXJ0cmVxdWVzdC86X2lkJykgIFxyXG4gICAgLnB1dChmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIFRhc2suZmluZEJ5SWQocmVxLnBhcmFtcy5faWQsIGZ1bmN0aW9uKGVyciwgdGFzaykge1xyXG4gICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICAgICAgdGFzay50YXNrdHlwZSA9ICd0YXNrJzsgXHJcbiAgICAgICAgICAgIHRhc2suYXNzaWduZWR0byA9IHJlcS5ib2R5LmFzc2lnbmVkdG87IFxyXG4gICAgICAgICAgICB0YXNrLnRhc2tzdGF0dXMgPSAnT1BFTic7ICAgICAgICAgICBcclxuICAgICAgICAgICAgdGFzay5zYXZlKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICAgICAgcmVzLmpzb24oeyBtZXNzYWdlOiAndGFzayB1cGRhdGVkIScgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSlcclxuXHJcbiAgcm91dGVyLnJvdXRlKCcvYXBpL2dldGludGVybmFsdXNlcnMnKSAgICBcclxuICAgIC5nZXQoZnVuY3Rpb24ocmVxLCByZXMpIHsgICAgICAgIFxyXG4gICAgICAgIEludGVybmFsVXNlci5maW5kKHskYW5kOlt7RW1haWw6IHskZXhpc3RzOiB0cnVlLCAkbmU6IG51bGx9fSx7U3RhdHVzOidBY3RpdmUnfV19LCdFbWFpbCcsIGZ1bmN0aW9uKGVyciwgaW50ZXJuYWx1c2VycykgeyAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKGludGVybmFsdXNlcnMpOyAgICAgICAgICAgIFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSkgICAgICBcclxuICAgIFxyXG5hcHAudXNlKCcvJywgcm91dGVyKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
