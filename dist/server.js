"use strict";
var express = require('express');
var path = require('path');
var port = process.env.PORT || 3000;
var app = express();
var bodyParser = require('body-parser');
var mongoose = require('mongoose');
var jwt = require('express-jwt');
var cors = require('cors');
var router = express.Router();
var Apartment = require('./models/apartment');
var BusinessUnit = require('./models/businessunit');
var Task = require('./models/task');
app.use('/app', express.static(path.resolve(__dirname, 'app')));
app.use('/libs', express.static(path.resolve(__dirname, 'libs')));
app.use(cors());
var dbstring = process.env.MONGOLAB_URI ||
    process.env.MONGOHQ_URL ||
    'mongodb://heroku_d4n6hnhl:q4rfc1uikd51d5sups9mipivnl@ds057254.mlab.com:57254/heroku_d4n6hnhl';
var server = app.listen(port, function () {
    var host = server.address().address;
    var port = server.address().port;
    console.log('This express app is listening on port:' + port);
});
var authCheck = jwt({
    secret: new Buffer('460DPY7Pi4xnRUiirPuEfBdxS4wzQGcx8rlA-Qw76fURkmiwtrhv_IXffzsI84HM', 'base64'),
    audience: '1mvHGykVHvxzpwstp2wTmrzLrpzouVTm'
});
mongoose.connect(dbstring, function (err, res) {
    if (err) {
        console.log('ERROR connecting to: ' + dbstring + '. ' + err);
    }
    else {
        console.log('Successfully connected to: ' + dbstring);
    }
    ;
});
app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());
router.get('/app/*', function (req, res) {
    res.sendFile(path.resolve(__dirname, 'index.html'));
});
router.get('/api', authCheck, function (req, res) {
    res.json({ message: 'hooray! welcome to our api!' });
});
router.route('/api/apartments')
    .post(function (req, res) {
    var apartment = new Apartment();
    apartment.UnitAddress = req.body.taskname;
    apartment.save(function (err) {
        if (err)
            res.send(err);
        res.json({ message: 'Apartment created!' });
    });
})
    .get(function (req, res) {
    Apartment.find({ unitID: { $exists: true }, UnitType: { $exists: true } }, 'unitID UnitType', function (err, apartments) {
        if (err)
            res.send(err);
        res.json(apartments);
    });
});
router.route('/api/apartments/:apartment_id')
    .get(function (req, res) {
    Apartment.findById(req.params.apartment_id, function (err, apartment) {
        if (err)
            res.send(err);
        res.json(apartment);
    });
});
router.route('/api/apartments/getprofile/:userEmail')
    .get(function (req, res) {
    Apartment.find({ userEmail: req.params.userEmail }, '-_id', function (err, apartment) {
        if (err)
            res.send(err);
        res.json(apartment);
    });
})
    .put(function (req, res) {
    Apartment.findById(req.params.apartment_id, function (err, apartment) {
        if (err)
            res.send(err);
        apartment.name = req.body.name;
        apartment.save(function (err) {
            if (err)
                res.send(err);
            res.json({ message: 'apartment updated!' });
        });
    });
})
    .delete(function (req, res) {
    Apartment.remove({
        _id: req.params.apartment_id
    }, function (err, apartment) {
        if (err)
            res.send(err);
        res.json({ message: 'Successfully deleted' });
    });
});
router.route('/api/businessunits')
    .get(function (req, res) {
    BusinessUnit.find(function (err, businessunits) {
        if (err)
            res.send(err);
        res.json(businessunits);
    });
});
/*Task Endpoints*/
router.route('/api/newtask')
    .post(function (req, res) {
    var task = new Task();
    task.taskname = req.body.taskname;
    task.taskdesc = req.body.taskdesc;
    task.save(function (err) {
        if (err)
            res.send(err);
        res.json({ message: 'Task created!' });
    });
})
    .get(function (req, res) {
    Task.find(function (err, tasks) {
        if (err)
            res.send(err);
        res.json(tasks);
    });
});
router.route('/api/newtask/:task_id')
    .get(function (req, res) {
    Task.findById(req.params.task_id, function (err, task) {
        if (err)
            res.send(err);
        res.json(task);
    });
})
    .put(function (req, res) {
    Task.findById(req.params.task_id, function (err, task) {
        if (err)
            res.send(err);
        task.name = req.body.name;
        task.save(function (err) {
            if (err)
                res.send(err);
            res.json({ message: 'task updated!' });
        });
    });
})
    .delete(function (req, res) {
    Task.remove({
        _id: req.params.task_id
    }, function (err, task) {
        if (err)
            res.send(err);
        res.json({ message: 'Successfully deleted' });
    });
});
app.use('/', router);

//# sourceMappingURL=data:application/json;base64,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SSxDQUFDLFVBQVMsR0FBRyxFQUFFLEdBQUc7SUFDbkIsSUFBSSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUN0QixJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ2xDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7SUFFbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFTLEdBQUc7UUFDbEIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ0osR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxDQUFDLENBQUM7SUFDM0MsQ0FBQyxDQUFDLENBQUM7QUFDVCxDQUFDLENBQUM7S0FDQyxHQUFHLENBQUMsVUFBUyxHQUFHLEVBQUUsR0FBRztJQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVMsR0FBRyxFQUFFLEtBQUs7UUFDekIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ0osR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVsQixHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3BCLENBQUMsQ0FBQyxDQUFDO0FBQ1QsQ0FBQyxDQUFDLENBQUM7QUFFSCxNQUFNLENBQUMsS0FBSyxDQUFDLHVCQUF1QixDQUFDO0tBQ2xDLEdBQUcsQ0FBQyxVQUFTLEdBQUcsRUFBRSxHQUFHO0lBQ2xCLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsVUFBUyxHQUFHLEVBQUUsSUFBSTtRQUNoRCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDSixHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkIsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUM7S0FFRCxHQUFHLENBQUMsVUFBUyxHQUFHLEVBQUUsR0FBRztJQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLFVBQVMsR0FBRyxFQUFFLElBQUk7UUFDaEQsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ0osR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQixJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBUyxHQUFHO1lBQ2xCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQztnQkFDSixHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2xCLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUMsQ0FBQztRQUMzQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDO0tBRUQsTUFBTSxDQUFDLFVBQVMsR0FBRyxFQUFFLEdBQUc7SUFDckIsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUNSLEdBQUcsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLE9BQU87S0FDMUIsRUFBRSxVQUFTLEdBQUcsRUFBRSxJQUFJO1FBQ2pCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUNKLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFbEIsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxDQUFDLENBQUM7SUFDbEQsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQztBQUlQLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDIiwiZmlsZSI6InNlcnZlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5pbXBvcnQgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcclxudmFyIHBvcnQ6IG51bWJlciA9IHByb2Nlc3MuZW52LlBPUlQgfHwgMzAwMDtcclxudmFyIGFwcCA9IGV4cHJlc3MoKTtcclxudmFyIGJvZHlQYXJzZXIgPSByZXF1aXJlKCdib2R5LXBhcnNlcicpO1xyXG52YXIgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xyXG52YXIgand0ID0gcmVxdWlyZSgnZXhwcmVzcy1qd3QnKTtcclxudmFyIGNvcnMgPSByZXF1aXJlKCdjb3JzJyk7XHJcbnZhciByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5cclxudmFyIEFwYXJ0bWVudCA9IHJlcXVpcmUoJy4vbW9kZWxzL2FwYXJ0bWVudCcpO1xyXG52YXIgQnVzaW5lc3NVbml0ID0gcmVxdWlyZSgnLi9tb2RlbHMvYnVzaW5lc3N1bml0Jyk7IFxyXG52YXIgVGFzayA9IHJlcXVpcmUoJy4vbW9kZWxzL3Rhc2snKTtcclxuXHJcbmFwcC51c2UoJy9hcHAnLCBleHByZXNzLnN0YXRpYyhwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnYXBwJykpKTtcclxuYXBwLnVzZSgnL2xpYnMnLCBleHByZXNzLnN0YXRpYyhwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnbGlicycpKSk7XHJcbmFwcC51c2UoY29ycygpKTtcclxuXHJcbnZhciBkYnN0cmluZyA9XHJcbiAgICBwcm9jZXNzLmVudi5NT05HT0xBQl9VUkkgfHxcclxuICAgIHByb2Nlc3MuZW52Lk1PTkdPSFFfVVJMIHx8XHJcbiAgICAnbW9uZ29kYjovL2hlcm9rdV9kNG42aG5obDpxNHJmYzF1aWtkNTFkNXN1cHM5bWlwaXZubEBkczA1NzI1NC5tbGFiLmNvbTo1NzI1NC9oZXJva3VfZDRuNmhuaGwnO1xyXG5cclxudmFyIHNlcnZlciA9IGFwcC5saXN0ZW4ocG9ydCwgZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgaG9zdCA9IHNlcnZlci5hZGRyZXNzKCkuYWRkcmVzcztcclxuICAgIHZhciBwb3J0ID0gc2VydmVyLmFkZHJlc3MoKS5wb3J0O1xyXG4gICAgY29uc29sZS5sb2coJ1RoaXMgZXhwcmVzcyBhcHAgaXMgbGlzdGVuaW5nIG9uIHBvcnQ6JyArIHBvcnQpO1xyXG59KTtcclxuXHJcbnZhciBhdXRoQ2hlY2sgPSBqd3Qoe1xyXG4gIHNlY3JldDogbmV3IEJ1ZmZlcignNDYwRFBZN1BpNHhuUlVpaXJQdUVmQmR4UzR3elFHY3g4cmxBLVF3NzZmVVJrbWl3dHJodl9JWGZmenNJODRITScsICdiYXNlNjQnKSxcclxuICBhdWRpZW5jZTogJzFtdkhHeWtWSHZ4enB3c3RwMndUbXJ6THJwem91VlRtJ1xyXG59KTtcclxuXHJcbm1vbmdvb3NlLmNvbm5lY3QoZGJzdHJpbmcsIGZ1bmN0aW9uIChlcnIsIHJlcykge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nICgnRVJST1IgY29ubmVjdGluZyB0bzogJyArIGRic3RyaW5nICsgJy4gJyArIGVycik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUubG9nICgnU3VjY2Vzc2Z1bGx5IGNvbm5lY3RlZCB0bzogJyArIGRic3RyaW5nKTtcclxuICAgICAgfTtcclxufSk7XHJcblxyXG5hcHAudXNlKGJvZHlQYXJzZXIudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKTtcclxuYXBwLnVzZShib2R5UGFyc2VyLmpzb24oKSk7XHJcblxyXG5yb3V0ZXIuZ2V0KCcvYXBwLyonLCBmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICByZXMuc2VuZEZpbGUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJ2luZGV4Lmh0bWwnKSk7XHJcbn0pO1xyXG5cclxucm91dGVyLmdldCgnL2FwaScsYXV0aENoZWNrLCBmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICByZXMuanNvbih7IG1lc3NhZ2U6ICdob29yYXkhIHdlbGNvbWUgdG8gb3VyIGFwaSEnIH0pO1xyXG59KTtcclxuXHJcbiAgIHJvdXRlci5yb3V0ZSgnL2FwaS9hcGFydG1lbnRzJylcclxuICAgIC5wb3N0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7ICAgICAgICBcclxuICAgICAgICB2YXIgYXBhcnRtZW50ID0gbmV3IEFwYXJ0bWVudCgpO1xyXG4gICAgICAgIGFwYXJ0bWVudC5Vbml0QWRkcmVzcyA9IHJlcS5ib2R5LnRhc2tuYW1lO1xyXG5cclxuICAgICAgICBhcGFydG1lbnQuc2F2ZShmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ0FwYXJ0bWVudCBjcmVhdGVkIScgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgfSlcclxuICAvLyAgIC5nZXQoZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAvLyAgICAgICBBcGFydG1lbnQuZmluZChmdW5jdGlvbihlcnIsIGFwYXJ0bWVudHMpIHtcclxuICAvLyAgICAgICAgICAgaWYgKGVycilcclxuICAvLyAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcblxyXG4gIC8vICAgICAgICAgICByZXMuanNvbihhcGFydG1lbnRzKTtcclxuICAvLyAgICAgICB9KTtcclxuICAvLyB9KTtcclxuXHJcbiAgLmdldChmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIEFwYXJ0bWVudC5maW5kKHt1bml0SUQ6IHskZXhpc3RzOiB0cnVlfSwgVW5pdFR5cGU6IHskZXhpc3RzOiB0cnVlfX0sJ3VuaXRJRCBVbml0VHlwZScsZnVuY3Rpb24oZXJyLCBhcGFydG1lbnRzKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG5cclxuICAgICAgICAgICAgcmVzLmpzb24oYXBhcnRtZW50cyk7XHJcbiAgICAgICAgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgcm91dGVyLnJvdXRlKCcvYXBpL2FwYXJ0bWVudHMvOmFwYXJ0bWVudF9pZCcpICAgIFxyXG4gICAgLmdldChmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIEFwYXJ0bWVudC5maW5kQnlJZChyZXEucGFyYW1zLmFwYXJ0bWVudF9pZCwgZnVuY3Rpb24oZXJyLCBhcGFydG1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKGFwYXJ0bWVudCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KVxyXG5cclxuICAgIHJvdXRlci5yb3V0ZSgnL2FwaS9hcGFydG1lbnRzL2dldHByb2ZpbGUvOnVzZXJFbWFpbCcpICAgIFxyXG4gICAgLmdldChmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIEFwYXJ0bWVudC5maW5kKHt1c2VyRW1haWw6cmVxLnBhcmFtcy51c2VyRW1haWx9LCctX2lkJywgZnVuY3Rpb24oZXJyLCBhcGFydG1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKGFwYXJ0bWVudCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KVxyXG5cclxuICAgLy8gICoqVGhlIGFib3ZlIGNvZGUgY2FuIGJlIHdyaXR0ZW4gYXMgZm9sbG93cyBhcyB3ZWxsICoqXHJcbiAgIC8vICByb3V0ZXIucm91dGUoJy9hcGkvYXBhcnRtZW50cy9nZXRwcm9maWxlMS86VXNlckVtYWlsJykgICAgXHJcbiAgIC8vICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgIC8vICAgICAgdmFyIHF1ZXJ5ID0gQXBhcnRtZW50LmZpbmQoe30pLnNlbGVjdCgnLndoZXJlKHt1c2VyRW1haWw6cmVxLnBhcmFtcy5Vc2VyRW1haWx9KTsgLV9pZCcpLndoZXJlKHt1c2VyRW1haWw6cmVxLnBhcmFtcy5Vc2VyRW1haWx9KTtcclxuICAgLy8gICAgICAgICBxdWVyeS5leGVjKGZ1bmN0aW9uIChlcnIsIEFwYXJ0bWVudCkge1xyXG4gICAvLyAgICAgIGlmIChlcnIpIHJldHVybiBuZXh0KGVycik7XHJcbiAgIC8vICAgICAgcmVzLnNlbmQoQXBhcnRtZW50KTtcclxuICAgLy8gIH0pO1xyXG4gICAvLyB9KVxyXG5cclxuICAgIC5wdXQoZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgICAgICBBcGFydG1lbnQuZmluZEJ5SWQocmVxLnBhcmFtcy5hcGFydG1lbnRfaWQsIGZ1bmN0aW9uKGVyciwgYXBhcnRtZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICBhcGFydG1lbnQubmFtZSA9IHJlcS5ib2R5Lm5hbWU7ICBcclxuICAgICAgICAgICAgYXBhcnRtZW50LnNhdmUoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdhcGFydG1lbnQgdXBkYXRlZCEnIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pXHJcblxyXG4gICAgLmRlbGV0ZShmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIEFwYXJ0bWVudC5yZW1vdmUoe1xyXG4gICAgICAgICAgICBfaWQ6IHJlcS5wYXJhbXMuYXBhcnRtZW50X2lkXHJcbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyLCBhcGFydG1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcblxyXG4gICAgICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdTdWNjZXNzZnVsbHkgZGVsZXRlZCcgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByb3V0ZXIucm91dGUoJy9hcGkvYnVzaW5lc3N1bml0cycpICAgICAgICAgICAgIFxyXG4gICAgLmdldChmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIEJ1c2luZXNzVW5pdC5maW5kKGZ1bmN0aW9uKGVyciwgYnVzaW5lc3N1bml0cykge1xyXG4gICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuXHJcbiAgICAgICAgICAgIHJlcy5qc29uKGJ1c2luZXNzdW5pdHMpO1xyXG4gICAgICAgIH0pO1xyXG4gIH0pO1xyXG4gIFxyXG4gIC8qVGFzayBFbmRwb2ludHMqL1xyXG5cclxuICByb3V0ZXIucm91dGUoJy9hcGkvbmV3dGFzaycpXHJcbiAgICAucG9zdChmdW5jdGlvbihyZXEsIHJlcykgeyAgICAgICAgXHJcbiAgICAgICAgdmFyIHRhc2sgPSBuZXcgVGFzaygpO1xyXG4gICAgICAgIHRhc2sudGFza25hbWUgPSByZXEuYm9keS50YXNrbmFtZTtcclxuICAgICAgICB0YXNrLnRhc2tkZXNjID0gcmVxLmJvZHkudGFza2Rlc2M7XHJcblxyXG4gICAgICAgIHRhc2suc2F2ZShmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ1Rhc2sgY3JlYXRlZCEnIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gIH0pXHJcbiAgICAuZ2V0KGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgVGFzay5maW5kKGZ1bmN0aW9uKGVyciwgdGFza3MpIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcblxyXG4gICAgICAgICAgICByZXMuanNvbih0YXNrcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgcm91dGVyLnJvdXRlKCcvYXBpL25ld3Rhc2svOnRhc2tfaWQnKSAgICBcclxuICAgIC5nZXQoZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgICAgICBUYXNrLmZpbmRCeUlkKHJlcS5wYXJhbXMudGFza19pZCwgZnVuY3Rpb24oZXJyLCB0YXNrKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICByZXMuanNvbih0YXNrKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pXHJcblxyXG4gICAgLnB1dChmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIFRhc2suZmluZEJ5SWQocmVxLnBhcmFtcy50YXNrX2lkLCBmdW5jdGlvbihlcnIsIHRhc2spIHtcclxuICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgICAgIHRhc2submFtZSA9IHJlcS5ib2R5Lm5hbWU7ICBcclxuICAgICAgICAgICAgdGFzay5zYXZlKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICAgICAgcmVzLmpzb24oeyBtZXNzYWdlOiAndGFzayB1cGRhdGVkIScgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSlcclxuXHJcbiAgICAuZGVsZXRlKGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgVGFzay5yZW1vdmUoe1xyXG4gICAgICAgICAgICBfaWQ6IHJlcS5wYXJhbXMudGFza19pZFxyXG4gICAgICAgIH0sIGZ1bmN0aW9uKGVyciwgdGFzaykge1xyXG4gICAgICAgICAgICBpZiAoZXJyKVxyXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuXHJcbiAgICAgICAgICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSBkZWxldGVkJyB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuXHJcblxyXG5hcHAudXNlKCcvJywgcm91dGVyKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
